"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[95],{3647:(D,y,a)=>{a.d(y,{I:()=>I});var p=a(5e3),e=a(5384),d=a(1200);let I=(()=>{class c{constructor(h,l){this.apiService=h,this._projetService=l}getAll(){return this.apiService.get("api/acquisition")}findBySite(h){return this.apiService.get("api/acquisition/findBySite/"+h)}findByTerrain(h){return this.apiService.get("api/acquisition/findByTerrain/"+h)}findByAcquereur(h){return this.apiService.get("api/acquisition/findByAcquereur/"+h)}getAllPaginate(h,l){return this.apiService.get("api/acquisition/paginate/"+h+"/"+l)}get(h){return this.apiService.get("api/acquisition/"+h)}add(h){var l;return h.projet_id=null===(l=this._projetService.projet)||void 0===l?void 0:l.id,this.apiService.post("api/acquisition",h)}update(h){return this.apiService.put("api/acquisition/"+h.id,h)}delete(h){return this.apiService.delete("api/acquisition/"+h.id)}}return c.\u0275fac=function(h){return new(h||c)(p.LFG(e.s),p.LFG(d.Z))},c.\u0275prov=p.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},4922:(D,y,a)=>{a.d(y,{U:()=>I});var p=a(5e3),e=a(5384),d=a(1200);let I=(()=>{class c{constructor(h,l){this.apiService=h,this._projetService=l}getAll(){return this.apiService.get("api/terrain")}getAllPaginate(h,l){return this.apiService.get("api/terrain/paginate/"+h+"/"+l)}get(h){return this.apiService.get("api/terrain/"+h)}add(h){var l;return h.projet_id=null===(l=this._projetService.projet)||void 0===l?void 0:l.id,this.apiService.post("api/terrain",h)}update(h){return this.apiService.put("api/terrain/"+h.id,h)}delete(h){return this.apiService.delete("api/terrain/"+h.id)}}return c.\u0275fac=function(h){return new(h||c)(p.LFG(e.s),p.LFG(d.Z))},c.\u0275prov=p.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},1095:(D,y,a)=>{a.r(y),a.d(y,{DashboardModule:()=>yt});var p=a(9808),e=a(5e3),d=a(3075),I=a(2430),c=a(1220),x=a.n(c),h=a(4999),l=a(7454),N=a(3647),w=a(4521),P=a(4922),J=a(5245),O=a(7322),A=a(4107),f=a(508),Z=a(8197),Y=a(7423),V=a(7238);function q(s,o){1&s&&e._UZ(0,"mat-icon",12),2&s&&e.Q6J("svgIcon","heroicons_outline:arrows-expand")}function U(s,o){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-option",13),e.NdJ("click",function(){const r=e.CHM(t).$implicit;return e.oxw().optionClick(r)}),e.TgZ(2,"div",14),e._uU(3),e.qZA(),e.TgZ(4,"div",15),e._uU(5),e.qZA()(),e.BQk()}if(2&s){const t=o.$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(2),e.Oqu(t.label),e.xp6(2),e.Oqu(t.description)}}function j(s,o){if(1&s&&e._UZ(0,"highcharts-chart",22),2&s){const t=e.oxw(2);e.Q6J("Highcharts",t.Highcharts)("constructorType",t.chartConstructor)("options",t.chartOptions)}}function K(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",17)(2,"div",18),e.YNc(3,j,1,3,"highcharts-chart",19),e.TgZ(4,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw().toggleFullscreen()}),e.GkF(5,21),e.qZA()()()()}if(2&s){const t=e.oxw(),i=e.MAs(2);e.xp6(3),e.Q6J("ngIf",t.isRefresh),e.xp6(1),e.Q6J("matTooltip",t.tooltip||"Toggle Fullscreen"),e.xp6(1),e.Q6J("ngTemplateOutlet",t.iconTpl||i)}}let z=(()=>{class s{constructor(t,i,n,r,u){this._siteService=t,this._acquisitionService=i,this._document=n,this._router=r,this._terrainService=u,this._isFullscreen=!1,this.siteAvatarForm=new d.NI(""),this.site=new I.T({}),this.geoJSON=null,this.afficherLibelleSite="",this.regrouperParForm=new d.NI(""),this.Highcharts=x(),this.chartConstructor="mapChart",this.isRefresh=!1,this.dataSource=new h.by,this.displayedColumns=["code","name","contenance","typeLogement"],this.enPleinEcran=!1,this.chartOptions={},this.listTerrains=[],this._fsDoc=n}ngOnInit(){this._siteService.getAll().subscribe(t=>{const i=t;if(this.optionsGroup=[],this.optionsGroup.push({label:"Pas de choix",value:0,description:""}),i.forEach(n=>{this.optionsGroup.push({label:n.libelle,value:n.id,description:n.description,geoJSON:n.geoJSON})}),this.regrouperPar=[this.optionsGroup[0]],sessionStorage.getItem("optionSiteSelect")){const n=JSON.parse(sessionStorage.getItem("optionSiteSelect")),r=this.optionsGroup.find(u=>u.value===n.value);this.regrouperPar=[r],this.optionClick(r)}}),this.initListTerrain()}initListTerrain(){if(sessionStorage.getItem("terrain")){let t=JSON.parse(sessionStorage.getItem("terrain"));this.listTerrains=t}this._terrainService.getAll().subscribe(t=>{this.listTerrains=t,sessionStorage.setItem("terrain",JSON.stringify(t))},t=>{this.listTerrains=[]})}optionClick(t){0!=t.value?(this.regrouperParForm.setValue(t),sessionStorage.setItem("optionSiteSelect",JSON.stringify(t))):this.regrouperParForm.setValue(null),this.afficherLibelleSite=t.label,this.visualiser()}visualiser(){var t,i;const n=this;this._siteService.getGeoJSONAsJSON(null===(i=null===(t=this.regrouperParForm)||void 0===t?void 0:t.value)||void 0===i?void 0:i.geoJSON).subscribe(r=>{var u,b;this.geoJSON=r;const S=m=>{switch(m){case"PARTICULIER":return"#FF5733";case"ENTREPRISE":return"#D68910";case"INDUSTRIE":return"#82E0AA";case"PROPRIETAIRE_TERRIEN":return"#1E8449";case"SERVICE_PUBLIC":return"#2874A6";default:return"#F9E79F"}};this.dataSource.data=[],this._acquisitionService.findBySite(null===(b=null===(u=this.regrouperParForm)||void 0===u?void 0:u.value)||void 0===b?void 0:b.value).subscribe(m=>{let C=JSON.parse(JSON.stringify(this.listTerrains));m.forEach(v=>{this.dataSource.data.push(Object.assign(Object.assign({},v.terrain),{proprietaire:v.acquereur.genre+" "+v.acquereur.nom+" "+v.acquereur.prenom,typeAcquereur:v.acquereur.typeAcquereur,color:S(v.acquereur.typeAcquereur)}));let H=C.findIndex(St=>St.id==v.terrain_id);H>-1&&C.splice(H,1)}),console.log("====>",C),C.forEach(v=>{this.dataSource.data.push(Object.assign(Object.assign({},v),{color:S(null),occupation:"NON OCCUPE"}))}),this.isRefresh=!1,setTimeout(()=>{this.isRefresh=!0},1)},m=>{this.isRefresh=!1,setTimeout(()=>{this.isRefresh=!0},1)}),this.chartOptions={chart:{map:this.geoJSON},title:{text:"SITE de "+this.afficherLibelleSite},subtitle:{},mapNavigation:{enabled:!0,buttonOptions:{alignTo:"spacingBox"}},legend:{enabled:!1},colorAxis:{min:0},series:[{type:"map",name:"Parcelle",states:{hover:{color:"#BADA55"}},dataLabels:{enabled:!0,format:"{point.name}"},allAreas:!0,data:this.dataSource.data,joinBy:["code","code"],point:{events:{click:function(m){if(m.ctrlKey||m.shiftKey){const C=n._router.serializeUrl(n._router.createUrlTree(["/terrain/show",this.id]));window.open(C,"_blank")}}}}}],tooltip:{formatter:function(){return"<b>"+this.point.name+"</b><br>Code: "+this.point.code+"<br>Superficie: "+this.point.superficie+"<br>"+(this.point.typeLogement?"Type Logement: "+this.point.typeLogement+"<br>":"")+(this.point.proprietaire?"Nom Acquereur: "+this.point.proprietaire+"<br>":"")+(this.point.typeAcquereur?"Type Acquereur: "+this.point.typeAcquereur+"<br>":"")+(this.point.occupation?"NON OCCUPE<br>":"")}},credits:{enabled:!1},exporting:{showTable:!0,allowHTML:!0}}},r=>{console.log(r),this.geoJSON=null})}toggleFullscreen(){this._isFullscreen=null!==this._getBrowserFullscreenElement(),this._isFullscreen?this._closeFullscreen():this._openFullscreen()}_getBrowserFullscreenElement(){if(void 0!==this._fsDoc.fullscreenElement)return this._fsDoc.fullscreenElement;if(void 0!==this._fsDoc.mozFullScreenElement)return this._fsDoc.mozFullScreenElement;if(void 0!==this._fsDoc.msFullscreenElement)return this._fsDoc.msFullscreenElement;if(void 0!==this._fsDoc.webkitFullscreenElement)return this._fsDoc.webkitFullscreenElement;throw new Error("Fullscreen mode is not supported by this browser")}_openFullscreen(){this._fsDocEl=document.getElementById("container"),this._fsDocEl.requestFullscreen?this._fsDocEl.requestFullscreen():this._fsDocEl.mozRequestFullScreen?this._fsDocEl.mozRequestFullScreen():this._fsDocEl.webkitRequestFullscreen?this._fsDocEl.webkitRequestFullscreen():this._fsDocEl.msRequestFullscreen&&this._fsDocEl.msRequestFullscreen()}_closeFullscreen(){this._fsDoc.exitFullscreen?this._fsDoc.exitFullscreen():this._fsDoc.mozCancelFullScreen?this._fsDoc.mozCancelFullScreen():this._fsDoc.webkitExitFullscreen?this._fsDoc.webkitExitFullscreen():this._fsDoc.msExitFullscreen&&this._fsDoc.msExitFullscreen()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(l.P),e.Y36(N.I),e.Y36(p.K0),e.Y36(w.F0),e.Y36(P.U))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-carto"]],inputs:{iconTpl:"iconTpl",tooltip:"tooltip"},decls:17,vars:5,consts:[[1,"flex","flex-col","flex-auto","min-w-0"],["defaultIconTpl",""],[1,"flex","flex-col","flex-auto","items-center","p-6","sm:p-10"],[1,"flex","flex-col","w-full"],[1,"flex","text-4xl","sm:text-2xl","font-extrabold","tracking-tight","leading-tight"],[1,"flex","w-1/3","text-right",2,"align-self","center"],[1,"w-full"],[3,"panelClass","formControl"],[1,"text-md"],[1,"ml-1","font-medium"],[4,"ngFor","ngForOf"],["class","pb-7 sm:p-1 sm:pb-7 shadow rounded-2xl bg-card  bg-white dark:bg-white-500",4,"ngIf"],[3,"svgIcon"],[1,"h-auto","py-4","leading-none",3,"value","click"],[1,"font-medium"],[1,"mt-1.5","text-sm","whitespace-normal","leading-normal","text-secondary"],[1,"pb-7","sm:p-1","sm:pb-7","shadow","rounded-2xl","bg-card","bg-white","dark:bg-white-500"],[1,"flex","flex-col","flex-auto"],["id","map-container",1,"flex","w-full","bg-white","dark:bg-white-500"],["id","container","style","width: 100%; height: 90vh; display: block;",3,"Highcharts","constructorType","options",4,"ngIf"],["mat-icon-button","",3,"matTooltip","click"],[3,"ngTemplateOutlet"],["id","container",2,"width","100%","height","90vh","display","block",3,"Highcharts","constructorType","options"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.YNc(1,q,1,1,"ng-template",null,1,e.W1O),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4),e._UZ(6,"div",5),e.TgZ(7,"div",5)(8,"mat-form-field",6)(9,"mat-select",7)(10,"mat-select-trigger",8)(11,"span"),e._uU(12,"Site :"),e.qZA(),e.TgZ(13,"span",9),e._uU(14),e.qZA()(),e.YNc(15,U,6,3,"ng-container",10),e.qZA()()()(),e.YNc(16,K,6,3,"div",11),e.qZA()()()),2&t&&(e.xp6(9),e.Q6J("panelClass","h-auto max-h-none")("formControl",i.regrouperParForm),e.xp6(5),e.Oqu(i.afficherLibelleSite),e.xp6(1),e.Q6J("ngForOf",i.optionsGroup),e.xp6(1),e.Q6J("ngIf",null!=i.geoJSON&&i.isRefresh))},directives:[J.Hw,O.KE,A.gD,d.JJ,d.oH,A.$L,p.sg,f.ey,p.O5,Z.x,Y.lW,V.gM,p.tP],styles:[""]}),s})(),G=(()=>{class s{constructor(){}ngOnInit(){}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-dashboard"]],decls:6,vars:0,consts:[[1,"flex","flex-col","flex-auto","min-w-0"],[1,"flex-auto","border-t","-mt-px"],[1,"w-full","max-w-screen-xl","mx-auto"],[1,"grid","grid-cols-1","sm:grid-cols-6","gap-6","w-full","min-w-0","p-6","pt-0","flex-col"],[1,"sm:col-span-6","flex","flex-col","flex-auto"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._UZ(5,"app-carto"),e.qZA()()()()())},directives:[z],styles:[""],encapsulation:2}),s})();var W=a(9703),_=a(1159);a(3191),a(6360),a(7579),a(6451),a(5698),a(2722),a(8675),a(925),a(5664),a(449),a(226);const k=new e.OlP("mat-chips-default-options");let gt=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[f.rD,{provide:k,useValue:{separatorKeyCodes:[_.K5]}}],imports:[[f.BQ]]}),s})();var _t=a(7e3),vt=a(9031),Ct=a(3170);const bt=[{path:"",component:G}];let yt=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[p.ez,w.Bz.forChild(bt),W.m,gt,_t.X,vt.vQ,Ct.v]]}),s})()}}]);